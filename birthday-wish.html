<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChÃºc Má»«ng Sinh Nháº­t</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./style.css?v=6.0">
    <script src="toast.js?v=1.0"></script>
</head>
<body class="birthday-wish">
    <div class="wish-container">
        <h1 class="main-title">ğŸ‰ ChÃºc Má»«ng Sinh Nháº­t! ğŸ‰</h1>
        
        <div class="book-container">
            <!-- BÃºt lÃ´ng vÅ© trang trÃ­ -->
            <div class="feather-pen">
                <div class="feather">
                    <div class="feather-shaft"></div>
                    <div class="feather-barbs">
                        <div class="barb"></div>
                        <div class="barb"></div>
                        <div class="barb"></div>
                        <div class="barb"></div>
                        <div class="barb"></div>
                    </div>
                </div>
                <div class="pen-nib"></div>
                <div class="ink-drop">ğŸ’§</div>
            </div>
            <div class="book" id="book">
                <div class="book-cover" onclick="openBook()">
                    <img src="images/anhbia.jpg" alt="Birthday Photo" class="cover-image">
                </div>
                
                <!-- Trang 1: Lá»i chÃºc chÃ­nh -->
                <div class="book-page page-1" id="page1" onclick="event.stopPropagation()">
                    <div class="wish-content">
                        <div class="page-header">
                            <span class="page-number">1</span>
                            <button class="edit-btn" onclick="toggleEdit(1)">âœï¸ Chá»‰nh sá»­a</button>
                        </div>
                        <div class="message editable-content" id="content1" contenteditable="false">
                            <p class="message-line">HÃ´m nay lÃ  ngÃ y Ä‘áº·c biá»‡t cá»§a em,</p>
                            <p class="message-line">Má»™t ngÃ y Ä‘Ã¡nh dáº¥u thÃªm má»™t tuá»•i má»›i.</p>
                            <p class="message-line">ChÃºc em luÃ´n xinh Ä‘áº¹p, Ä‘Ã¡ng iu,</p>
                            <p class="message-line">ChÃºc tuá»•i má»›i mang Ä‘áº¿n nhiá»u niá»m vui,</p>
                            <p class="message-line">ChÃºc em cÃ³ Ä‘Æ°á»£c táº¥t cáº£! ğŸ’•</p>
                            <p class="message-line">VÃ  Æ°á»›c mÆ¡ cá»§a em sáº½ thÃ nh hiá»‡n thá»±c! ğŸ‚</p>
                        </div>
                        <div class="edit-controls" id="controls1" style="display: none;">
                            <button onclick="saveContent(1)" class="save-btn">ğŸ’¾ LÆ°u</button>
                            <button onclick="cancelEdit(1)" class="cancel-btn">âŒ Há»§y</button>
                        </div>
                        <div class="page-nav">
                            <button onclick="nextPage()" class="nav-btn">Trang tiáº¿p theo â†’</button>
                        </div>
                    </div>
                </div>
                
                <!-- Trang 2: Ká»· niá»‡m -->
                <div class="book-page page-2" id="page2" style="display: none;" onclick="event.stopPropagation()">
                    <div class="wish-content">
                        <div class="page-header">
                            <span class="page-number">2</span>
                            <button class="edit-btn" onclick="toggleEdit(2)">âœï¸ Chá»‰nh sá»­a</button>
                        </div>
                        <div class="page-title">ğŸ“¸ Nhá»¯ng Ká»· Niá»‡m Äáº¹p</div>
                        <div class="message editable-content" id="content2" contenteditable="false">
                            <p class="message-line">Nhá»› láº¡i nhá»¯ng ngÃ y Ä‘áº§u quen nhau,</p>
                            <p class="message-line">Nhá»¯ng cÃ¢u chuyá»‡n, tiáº¿ng cÆ°á»i vui váº»,</p>
                            <p class="message-line">Nhá»¯ng chuyáº¿n Ä‘i, nhá»¯ng khoáº£nh kháº¯c,</p>
                            <p class="message-line">Táº¥t cáº£ Ä‘á»u lÃ  ká»· niá»‡m tuyá»‡t vá»i! ğŸŒŸ</p>
                            <p class="message-line">Cáº£m Æ¡n em Ä‘Ã£ lÃ  má»™t pháº§n</p>
                            <p class="message-line">trong cuá»™c Ä‘á»i nÃ y! ğŸ’–</p>
                        </div>
                        <div class="edit-controls" id="controls2" style="display: none;">
                            <button onclick="saveContent(2)" class="save-btn">ğŸ’¾ LÆ°u</button>
                            <button onclick="cancelEdit(2)" class="cancel-btn">âŒ Há»§y</button>
                        </div>
                        <div class="page-nav">
                            <button onclick="prevPage()" class="nav-btn">â† Trang trÆ°á»›c</button>
                            <button onclick="nextPage()" class="nav-btn">Trang tiáº¿p theo â†’</button>
                        </div>
                    </div>
                </div>
                
                <!-- Trang 3: Lá»i chÃºc tÆ°Æ¡ng lai -->
                <div class="book-page page-3" id="page3" style="display: none;" onclick="event.stopPropagation()">
                    <div class="wish-content">
                        <div class="page-header">
                            <span class="page-number">3</span>
                            <button class="edit-btn" onclick="toggleEdit(3)">âœï¸ Chá»‰nh sá»­a</button>
                        </div>
                        <div class="page-title">ğŸŒˆ Nhá»¯ng Äiá»u Æ¯á»›c Cho Em</div>
                        <div class="message editable-content" id="content3" contenteditable="false">
                            <p class="message-line">Mong em luÃ´n khá»e máº¡nh vÃ  háº¡nh phÃºc,</p>
                            <p class="message-line">Má»—i ngÃ y Ä‘á»u trÃ n Ä‘áº§y tiáº¿ng cÆ°á»i,</p>
                            <p class="message-line">CÃ´ng viá»‡c thuáº­n lá»£i, há»c táº­p tá»‘t,</p>
                            <p class="message-line">TÃ¬nh yÃªu ngá»t ngÃ o, gia Ä‘Ã¬nh áº¥m Ã¡p! ğŸ </p>
                            <p class="message-line">VÃ  luÃ´n nhá»› ráº±ng cÃ³ ngÆ°á»i</p>
                            <p class="message-line">sáº½ luÃ´n á»§ng há»™ em! ğŸ’ª</p>
                        </div>
                        <div class="edit-controls" id="controls3" style="display: none;">
                            <button onclick="saveContent(3)" class="save-btn">ğŸ’¾ LÆ°u</button>
                            <button onclick="cancelEdit(3)" class="cancel-btn">âŒ Há»§y</button>
                        </div>
                        <div class="page-nav">
                            <button onclick="prevPage()" class="nav-btn">â† Trang trÆ°á»›c</button>
                            <button onclick="nextPage()" class="nav-btn">Trang tiáº¿p theo â†’</button>
                        </div>
                    </div>
                </div>
                
                <!-- Trang 4: Lá»i káº¿t -->
                <div class="book-page page-4" id="page4" style="display: none;" onclick="event.stopPropagation()">
                    <div class="wish-content">
                        <div class="page-header">
                            <span class="page-number">4</span>
                            <button class="edit-btn" onclick="toggleEdit(4)">âœï¸ Chá»‰nh sá»­a</button>
                        </div>
                        <div class="page-title">ğŸ‰ Happy Birthday! ğŸ‰</div>
                        <div class="message special-message editable-content" id="content4" contenteditable="false">
                            <p class="message-line big-text">ChÃºc má»«ng sinh nháº­t!</p>
                            <p class="message-line">ğŸ‚ğŸˆğŸğŸŠ</p>
                            <p class="message-line">Hy vá»ng ngÃ y hÃ´m nay</p>
                            <p class="message-line">sáº½ tháº­t Ä‘áº·c biá»‡t vÃ  Ã½ nghÄ©a!</p>
                            <p class="message-line">VÃ  nhá»¯ng Ä‘iá»u tá»‘t Ä‘áº¹p nháº¥t</p>
                            <p class="message-line">sáº½ Ä‘áº¿n vá»›i em! âœ¨</p>
                        </div>
                        <div class="signature editable-content" id="signature4" contenteditable="false">
                            ğŸ’ Love you 3000 ğŸ’
                        </div>
                        <div class="edit-controls" id="controls4" style="display: none;">
                            <button onclick="saveContent(4)" class="save-btn">ğŸ’¾ LÆ°u</button>
                            <button onclick="cancelEdit(4)" class="cancel-btn">âŒ Há»§y</button>
                        </div>
                        <div class="page-nav">
                            <button onclick="prevPage()" class="nav-btn">â† Trang trÆ°á»›c</button>
                            <button onclick="closeBook()" class="nav-btn">ï¿½ ÄÃ³ng sá»•</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="click-hint" id="clickHint">ğŸ‘† Nháº¥p vÃ o sá»• Ä‘á»ƒ má»Ÿ nhÃ©!!!</div>

        <!-- NÃºt Ä‘iá»u khiá»ƒn nháº¡c -->
        <div class="music-control" id="musicControl" onclick="toggleMusic()">
            ğŸµ Báº­t nháº¡c
        </div>
        
        <div class="button-container">
            <a href="index.html" class="back-button">Quay láº¡i</a>
            <a href="gift.html" class="next-button">Tiáº¿p theo</a>
        </div>
    </div>

    <canvas class="confetti" id="confetti"></canvas>
    <div class="hearts-container" id="heartsContainer"></div>
    
    <!-- ThÃªm audio element -->
    <audio id="birthdayMusic" preload="auto">
        <source src="audio/birthday.mp3" type="audio/mpeg">
        <source src="audio/birthday-music.wav" type="audio/wav">
        <!-- Fallback cho cÃ¡c trÃ¬nh duyá»‡t khÃ´ng há»— trá»£ -->
        Your browser does not support the audio element.
    </audio>

    <script>
        // Functions for page navigation
        let currentPage = 1;
        const totalPages = 4;
        
        function showPage(pageNum) {
            // áº¨n táº¥t cáº£ cÃ¡c trang
            for (let i = 1; i <= totalPages; i++) {
                const page = document.getElementById(`page${i}`);
                if (page) {
                    page.style.display = 'none';
                }
            }
            
            // Hiá»ƒn thá»‹ trang hiá»‡n táº¡i
            const currentPageElement = document.getElementById(`page${pageNum}`);
            if (currentPageElement) {
                currentPageElement.style.display = 'flex';
            }
            
            currentPage = pageNum;
        }
        
        function nextPage() {
            if (currentPage < totalPages) {
                // PhÃ¡t Ã¢m thanh láº­t trang (tÃ¹y chá»n)
                playPageFlipSound();
                showPageWithAnimation(currentPage + 1);
            }
            // KhÃ´ng lÃ m gÃ¬ náº¿u Ä‘Ã£ á»Ÿ trang cuá»‘i - giá»¯ nguyÃªn sÃ¡ch má»Ÿ
        }
        
        function prevPage() {
            if (currentPage > 1) {
                // PhÃ¡t Ã¢m thanh láº­t trang (tÃ¹y chá»n)
                playPageFlipSound();
                showPageWithAnimation(currentPage - 1);
            }
        }
        
        function showPageWithAnimation(pageNum) {
            const currentPageElement = document.getElementById(`page${currentPage}`);
            const nextPageElement = document.getElementById(`page${pageNum}`);
            
            if (pageNum === currentPage) return;
            
            // Hiá»‡u á»©ng láº­t trang nhanh vÃ  mÆ°á»£t
            if (currentPageElement) {
                currentPageElement.classList.add('flipping-out');
                
                setTimeout(() => {
                    currentPageElement.style.display = 'none';
                    currentPageElement.classList.remove('flipping-out');
                }, 600);
            }
            
            // Hiá»ƒn thá»‹ trang má»›i
            if (nextPageElement) {
                setTimeout(() => {
                    nextPageElement.style.display = 'flex';
                    nextPageElement.classList.add('flipping-in');
                    
                    // Shimmer effect Ä‘Æ¡n giáº£n
                    nextPageElement.classList.add('page-shimmer');
                    setTimeout(() => {
                        nextPageElement.classList.add('active');
                    }, 50);
                    
                    // Cleanup
                    setTimeout(() => {
                        nextPageElement.classList.remove('flipping-in', 'page-shimmer', 'active');
                    }, 600);
                }, 300);
            }
            
            currentPage = pageNum;
        }
        
        // Simple page flip sound - optimized for performance
        function playPageFlipSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Simple swoosh sound
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            } catch (e) {
                console.log('Audio not available');
            }
        }

        // Interactive editing functions
        let originalContent = {};
        
        function toggleEdit(pageNum) {
            const content = document.getElementById(`content${pageNum}`);
            const controls = document.getElementById(`controls${pageNum}`);
            const editBtn = document.querySelector(`#page${pageNum} .edit-btn`);
            
            if (content.contentEditable === 'false') {
                // Báº¯t Ä‘áº§u chá»‰nh sá»­a
                originalContent[pageNum] = content.innerHTML;
                content.contentEditable = 'true';
                content.classList.add('editing');
                content.focus();
                controls.style.display = 'flex';
                editBtn.style.display = 'none';
                
                // Add typing sound effect
                content.addEventListener('input', playTypingSound);
            }
        }
        
        function saveContent(pageNum) {
            const content = document.getElementById(`content${pageNum}`);
            const controls = document.getElementById(`controls${pageNum}`);
            const editBtn = document.querySelector(`#page${pageNum} .edit-btn`);
            
            // LÆ°u vÃ o localStorage
            localStorage.setItem(`page${pageNum}Content`, content.innerHTML);
            
            // Káº¿t thÃºc chá»‰nh sá»­a
            content.contentEditable = 'false';
            content.classList.remove('editing');
            controls.style.display = 'none';
            editBtn.style.display = 'inline-block';
            
            // Remove typing sound listener
            content.removeEventListener('input', playTypingSound);
            
            // Show save notification
            showNotification('ğŸ’¾ ÄÃ£ lÆ°u thÃ nh cÃ´ng!');
        }
        
        function cancelEdit(pageNum) {
            const content = document.getElementById(`content${pageNum}`);
            const controls = document.getElementById(`controls${pageNum}`);
            const editBtn = document.querySelector(`#page${pageNum} .edit-btn`);
            
            // KhÃ´i phá»¥c ná»™i dung gá»‘c
            content.innerHTML = originalContent[pageNum];
            content.contentEditable = 'false';
            content.classList.remove('editing');
            controls.style.display = 'none';
            editBtn.style.display = 'inline-block';
            
            // Remove typing sound listener
            content.removeEventListener('input', playTypingSound);
        }
        
        function playTypingSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(800 + Math.random() * 200, audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(0.02, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                // Silent fail
            }
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }
        
        // Load saved content on page load
        function loadSavedContent() {
            for (let i = 1; i <= 4; i++) {
                const savedContent = localStorage.getItem(`page${i}Content`);
                if (savedContent) {
                    const content = document.getElementById(`content${i}`);
                    if (content) {
                        content.innerHTML = savedContent;
                    }
                }
            }
        }
        
        function resetBook() {
            currentPage = 1;
            showPage(currentPage);
        }

        function createConfetti() {
            const canvas = document.getElementById('confetti');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const confettiPieces = [];
            const colors = ['#ff9a9e', '#fecfef', '#fda085', '#ffb3ba', '#ff6b9d', '#ffc1cc'];

            for (let i = 0; i < 150; i++) {
                confettiPieces.push({
                    x: Math.random() * canvas.width,
                    y: -10,
                    width: Math.random() * 10 + 5,
                    height: Math.random() * 10 + 5,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    speed: Math.random() * 3 + 2,
                    rotation: Math.random() * 360
                });
            }

            function animateConfetti() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                confettiPieces.forEach((piece, index) => {
                    piece.y += piece.speed;
                    piece.rotation += 2;

                    ctx.save();
                    ctx.translate(piece.x + piece.width / 2, piece.y + piece.height / 2);
                    ctx.rotate(piece.rotation * Math.PI / 180);
                    ctx.fillStyle = piece.color;
                    ctx.fillRect(-piece.width / 2, -piece.height / 2, piece.width, piece.height);
                    ctx.restore();

                    if (piece.y > canvas.height) {
                        confettiPieces.splice(index, 1);
                    }
                });

                if (confettiPieces.length > 0) {
                    requestAnimationFrame(animateConfetti);
                }
            }

            animateConfetti();
        }

        function createHearts() {
            const heartsContainer = document.getElementById('heartsContainer');
            
            function addHeart() {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = 'ğŸ’–';
                
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDuration = (Math.random() * 3 + 5) + 's';
                heart.style.animationDelay = Math.random() * 2 + 's';
                
                heartsContainer.appendChild(heart);
                
                setTimeout(() => {
                    if (heart.parentNode) {
                        heart.parentNode.removeChild(heart);
                    }
                }, 8000);
            }
            
            const heartInterval = setInterval(addHeart, 800);
            
            setTimeout(() => {
                clearInterval(heartInterval);
            }, 20000);
        }

        // Báº¯t Ä‘áº§u hiá»‡u á»©ng khi trang load
        document.addEventListener('DOMContentLoaded', function() {
            createConfetti();
            createHearts();
            loadSavedContent(); // Load ná»™i dung Ä‘Ã£ lÆ°u
            
            // Tá»± Ä‘á»™ng phÃ¡t nháº¡c khi user tÆ°Æ¡ng tÃ¡c (cho mobile)
            const music = document.getElementById('birthdayMusic');
            const musicControl = document.getElementById('musicControl');
            let musicStarted = false;
            
            function startMusicOnInteraction() {
                if (!musicStarted && music.paused) {
                    music.volume = 0.5;
                    music.play().then(() => {
                        musicControl.textContent = 'ğŸµ Táº¯t nháº¡c';
                        musicStarted = true;
                        console.log('Nháº¡c ná»n Ä‘Ã£ báº¯t Ä‘áº§u phÃ¡t!');
                    }).catch(e => console.log('KhÃ´ng thá»ƒ phÃ¡t nháº¡c:', e));
                }
            }
            
            // Láº¯ng nghe má»i loáº¡i tÆ°Æ¡ng tÃ¡c Ä‘á»ƒ báº­t nháº¡c
            document.addEventListener('click', startMusicOnInteraction, { once: true });
            document.addEventListener('touchstart', startMusicOnInteraction, { once: true });
            document.addEventListener('touchend', startMusicOnInteraction, { once: true });
        });

        function openBook() {
            const book = document.getElementById('book');
            const clickHint = document.getElementById('clickHint');
            const music = document.getElementById('birthdayMusic');
            const musicControl = document.getElementById('musicControl');
            
            // Chá»‰ toggle open/close náº¿u sÃ¡ch chÆ°a má»Ÿ hoáº·c Ä‘ang á»Ÿ trang cuá»‘i vÃ  muá»‘n Ä‘Ã³ng
            if (!book.classList.contains('open')) {
                // Má»Ÿ sÃ¡ch
                book.classList.add('open');
                clickHint.textContent = 'ğŸ‘† Nháº¥p Ä‘á»ƒ Ä‘Ã³ng sá»•';
                clickHint.style.opacity = '0.7';
                
                // Hiá»ƒn thá»‹ trang Ä‘áº§u tiÃªn
                currentPage = 1;
                showPage(currentPage);
                
                // Hiá»ƒn thá»‹ bÃºt lÃ´ng vÅ© vá»›i delay Ä‘á»ƒ Ä‘á»“ng bá»™ vá»›i chá»¯
                setTimeout(() => {
                    const featherPen = document.querySelector('.feather-pen');
                    if (featherPen) {
                        featherPen.classList.add('show');
                    }
                }, 800); // Delay 0.8s Ä‘á»ƒ cÃ¢y bÃºt xuáº¥t hiá»‡n sau khi chá»¯ báº¯t Ä‘áº§u hiá»‡n
                
                // PhÃ¡t nháº¡c khi má»Ÿ sá»•
                music.currentTime = 0; // Reset vá» Ä‘áº§u bÃ i
                music.volume = 0.5; // Ã‚m lÆ°á»£ng 50%
                music.play().then(() => {
                    // Cáº­p nháº­t nÃºt khi nháº¡c phÃ¡t thÃ nh cÃ´ng
                    musicControl.textContent = 'ğŸµ Táº¯t nháº¡c';
                }).catch(error => {
                    console.log('KhÃ´ng thá»ƒ phÃ¡t nháº¡c:', error);
                    // Giá»¯ nguyÃªn nÃºt náº¿u khÃ´ng phÃ¡t Ä‘Æ°á»£c
                });
            }
        }
        
        function closeBook() {
            const book = document.getElementById('book');
            const clickHint = document.getElementById('clickHint');
            const music = document.getElementById('birthdayMusic');
            const musicControl = document.getElementById('musicControl');
            
            book.classList.remove('open');
            clickHint.textContent = 'ğŸ‘† Nháº¥p Ä‘á»ƒ má»Ÿ sá»•';
            clickHint.style.opacity = '1';
            
            // áº¨n bÃºt lÃ´ng vÅ©
            const featherPen = document.querySelector('.feather-pen');
            if (featherPen) {
                featherPen.classList.remove('show');
            }
            
            // Dá»«ng nháº¡c khi Ä‘Ã³ng sá»•
            music.pause();
            music.currentTime = 0;
            // Cáº­p nháº­t nÃºt khi dá»«ng nháº¡c
            musicControl.textContent = 'ğŸµ Báº­t nháº¡c';
            
            // Reset vá» trang Ä‘áº§u
            currentPage = 1;
            showPage(currentPage);
        }

        function toggleMusic() {
            const music = document.getElementById('birthdayMusic');
            const musicControl = document.getElementById('musicControl');
            
            if (music.paused) {
                music.play().then(() => {
                    musicControl.textContent = 'ğŸµ Táº¯t nháº¡c';
                }).catch(error => {
                    console.log('KhÃ´ng thá»ƒ phÃ¡t nháº¡c:', error);
                });
            } else {
                music.pause();
                musicControl.textContent = 'ğŸµ Báº­t nháº¡c';
            }
        }
    </script>
</body>
</html>
