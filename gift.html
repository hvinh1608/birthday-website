<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu√† Sinh Nh·∫≠t</title>
    <link rel="stylesheet" href="./style.css?v=5.0">
    <script src="toast.js"></script>
  </head>
  <body class="gift-body">
    <div id="photos-container"></div>
    <div id="sparkles-container"></div>
    <div id="hearts-container"></div>

    <!-- N√∫t ƒëi·ªÅu khi·ªÉn nh·∫°c -->
    <div class="music-control" id="musicControl" onclick="toggleMusic()">
        üéµ B·∫≠t nh·∫°c
    </div>
    
    <!-- N√∫t chuy·ªÉn sang trang mystery -->
    <div class="mystery-control" onclick="goToMystery()">
        üéÇ Mini Game
    </div>
    
    <!-- Th√™m audio element -->
    <audio id="giftMusic" preload="auto" loop autoplay>
        <source src="audio/birthday1.mp3" type="audio/mpeg">
        <source src="audio/birthday1.mp3" type="audio/mpeg">
        <!-- Fallback cho c√°c tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ -->
        Your browser does not support the audio element.
    </audio>

    <script>
        console.log('Page loaded - B·∫Øt ƒë·∫ßu t·∫°o animation');
        
        // Auto-start music when page loads
        document.addEventListener('DOMContentLoaded', function() {
            const music = document.getElementById('giftMusic');
            const musicControl = document.getElementById('musicControl');
            let musicStarted = false;
            
            // Th·ª≠ ph√°t nh·∫°c ngay khi page load
            music.volume = 0.3;
            music.play().then(() => {
                musicControl.textContent = 'üéµ T·∫Øt nh·∫°c';
                musicStarted = true;
                console.log('Nh·∫°c ƒë√£ b·∫Øt ƒë·∫ßu ph√°t t·ª± ƒë·ªông!');
            }).catch(error => {
                console.log('Kh√¥ng th·ªÉ ph√°t nh·∫°c t·ª± ƒë·ªông, ch·ªù user t∆∞∆°ng t√°c:', error);
                
                // B·∫Øt m·ªçi s·ª± ki·ªán touch/click tr√™n to√†n b·ªô m√†n h√¨nh ƒë·ªÉ ph√°t nh·∫°c
                function startMusicOnInteraction() {
                    if (!musicStarted && music.paused) {
                        music.play().then(() => {
                            musicControl.textContent = 'üéµ T·∫Øt nh·∫°c';
                            musicStarted = true;
                            console.log('Nh·∫°c ƒë√£ b·∫Øt ƒë·∫ßu ph√°t sau t∆∞∆°ng t√°c!');
                        }).catch(e => console.log('L·ªói ph√°t nh·∫°c:', e));
                    }
                }
                
                // L·∫Øng nghe m·ªçi lo·∫°i t∆∞∆°ng t√°c
                document.addEventListener('click', startMusicOnInteraction, { once: true });
                document.addEventListener('touchstart', startMusicOnInteraction, { once: true });
                document.addEventListener('touchend', startMusicOnInteraction, { once: true });
                document.addEventListener('keydown', startMusicOnInteraction, { once: true });
            });
        });
        
        // Function to toggle music
        function toggleMusic() {
            const music = document.getElementById('giftMusic');
            const musicControl = document.getElementById('musicControl');
            
            if (music.paused) {
                music.volume = 0.3;
                music.play().then(() => {
                    musicControl.textContent = 'üéµ T·∫Øt nh·∫°c';
                }).catch(error => {
                    console.log('Kh√¥ng th·ªÉ ph√°t nh·∫°c:', error);
                });
            } else {
                music.pause();
                musicControl.textContent = 'üéµ B·∫≠t nh·∫°c';
            }
        }
        
        // Chuy·ªÉn sang trang mystery-bag
        function goToMystery() {
            window.location.href = 'mystery-bag.html';
        }
        
        // T·∫°o photos ch·∫°y
        function createPhoto(index) {
            const photo = document.createElement('div');
            photo.className = 'gift-photo-runner';
            
            // M·∫£ng ch·ª©a 5 ·∫£nh kh√°c nhau
            const photoList = [
                'images/birthday.jpg',
                'images/photo1.jpg', 
                'images/photo2.jpg',
                'images/photo3.jpg',
                'images/photo4.jpg'
            ];
            
            // Ch·ªçn ·∫£nh theo th·ª© t·ª± ho·∫∑c ng·∫´u nhi√™n
            const photoIndex = index % photoList.length;
            photo.style.backgroundImage = `url('${photoList[photoIndex]}')`;
            
            const randomY = Math.random() * (window.innerHeight - 250);
            const delay = (index * 0.8) % 15; 
            
            // K√≠ch th∆∞·ªõc ng·∫´u nhi√™n
            const randomSize = 120 + Math.random() * 80; // T·ª´ 120px ƒë·∫øn 200px
            
            photo.style.top = randomY + 'px';
            photo.style.animationDelay = delay + 's';
            photo.style.zIndex = 100 + index;
            photo.style.width = randomSize + 'px';
            photo.style.height = randomSize + 'px';
            
            // Th√™m s·ª± ki·ªán hover v√† touch ƒë·ªÉ hi·ªán tr√°i tim
            photo.addEventListener('mouseenter', function() {
                showHeart(this);
            });
            
            // Th√™m touch support cho mobile
            photo.addEventListener('touchstart', function(e) {
                e.preventDefault(); // NgƒÉn scroll khi touch
                showHeart(this);
            });
            
            function showHeart(element) {
                const heart = document.createElement('div');
                heart.className = 'gift-hover-heart';
                heart.textContent = 'üíñ';
                element.appendChild(heart);
                
                // X√≥a tr√°i tim sau animation
                setTimeout(() => {
                    if (heart.parentNode) {
                        heart.parentNode.removeChild(heart);
                    }
                }, 600);
            }
            
            document.getElementById('photos-container').appendChild(photo);
            console.log(`T·∫°o photo ${index + 1} (${photoList[photoIndex]}) t·∫°i Y=${randomY.toFixed(0)}, size=${randomSize.toFixed(0)}px, delay=${delay.toFixed(1)}s`);
        }
        
        // T·∫°o sparkles
        function createSparkle(index) {
            const sparkle = document.createElement('div');
            sparkle.className = 'gift-sparkle';
            sparkle.textContent = '‚ú®';
            
            const randomX = Math.random() * window.innerWidth;
            const randomY = Math.random() * window.innerHeight;
            const delay = Math.random() * 4;
            
            sparkle.style.left = randomX + 'px';
            sparkle.style.top = randomY + 'px';
            sparkle.style.animationDelay = delay + 's';
            
            document.getElementById('sparkles-container').appendChild(sparkle);
        }
        
        // T·∫°o hearts
        function createHeart(index) {
            const heart = document.createElement('div');
            heart.className = 'gift-floating-heart';
            heart.textContent = '‚ù§Ô∏è';
            
            const randomX = Math.random() * window.innerWidth;
            const delay = Math.random() * 6;
            const size = 1 + Math.random() * 2;
            
            heart.style.left = randomX + 'px';
            heart.style.animationDelay = delay + 's';
            heart.style.fontSize = size + 'rem';
            
            document.getElementById('hearts-container').appendChild(heart);
        }
        
        // T·∫°o elements v·ªõi s·ªë l∆∞·ª£ng responsive
        const isMobile = window.innerWidth <= 768;
        const photoCount = isMobile ? 12 : 20; // Gi·∫£m s·ªë l∆∞·ª£ng tr√™n mobile
        const sparkleCount = isMobile ? 15 : 25;
        const heartCount = isMobile ? 10 : 20;
        
        for (let i = 0; i < photoCount; i++) {
            createPhoto(i);
        }
        
        for (let i = 0; i < sparkleCount; i++) { 
            createSparkle(i);
        }
        
        for (let i = 0; i < heartCount; i++) { 
            createHeart(i);
        }
        
        console.log(`T·∫•t c·∫£ elements ƒë√£ ƒë∆∞·ª£c t·∫°o! Photos: ${photoCount}, Sparkles: ${sparkleCount}, Hearts: ${heartCount}`);
    </script>
  </body>
</html>
